version: '3'
networks:
  commnet:
    ipam:
      config:
        - subnet: 172.20.0.0/24

services:
  node_1:
    image: "p2p-fl:latest"
    volumes:
      - ./demo:/home/demo
      - ./data/node-1:/home/work/p2plib/cmd/flat/data
    ports:
      - "8080:5000"
    environment:
      - NODE_ID=1
      - GROUP_ID=1
      - SELF_IP=172.20.0.2
    networks:
      commnet:
        ipv4_address: 172.20.0.2
    restart: on-failure
#    deploy:
#      resources:
#        limits:
#          memory: 1G

  node_2:
    image: "p2p-fl:latest"
    volumes:
      - ./demo:/home/demo
      - ./data/node-2:/home/work/p2plib/cmd/flat/data
    environment:
      - NODE_ID=2
      - GROUP_ID=1
      - SELF_IP=172.20.0.3
    networks:
      commnet:
        ipv4_address: 172.20.0.3
    restart: on-failure
    depends_on:
      - node_1
#    deploy:
#      resources:
#        limits:
#          memory: 1G
#
#  node_3:
#    image: "p2p-fl:latest"
#    volumes:
#      - ./demo:/home/demo
#      - ./data/node-3:/home/work/p2plib/cmd/flat/data
#    environment:
#      - NODE_ID=3
#      - GROUP_ID=1
#      - SELF_IP=172.20.0.4
#    networks:
#      commnet:
#        ipv4_address: 172.20.0.4
#    restart: on-failure
#    depends_on:
#      - node_2
#    deploy:
#      resources:
#        limits:
#          memory: 1G
#
#  node_4:
#    image: "p2p-fl:latest"
#    volumes:
#      - ./demo:/home/demo
#      - ./data/node-4:/home/work/p2plib/cmd/flat/data
#    environment:
#      - NODE_ID=4
#      - GROUP_ID=1
#      - SELF_IP=172.20.0.5
#    networks:
#      commnet:
#        ipv4_address: 172.20.0.5
#    restart: on-failure
#    depends_on:
#      - node_3
#    deploy:
#      resources:
#        limits:
#          memory: 1G

#
#  node_5:
#    image: "p2p-fl:latest"
#
#    volumes:
#      - ./demo:/home/demo
#      - ./data/node-5:/home/work/p2plib/cmd/flat/data
#    environment:
#      - NODE_ID=5
#      - GROUP_ID=2
#      - SELF_IP=172.20.0.6
#    networks:
#      commnet:
#        ipv4_address: 172.20.0.6
#    restart: on-failure
#    depends_on:
#      - node_4
#    deploy:
#      resources:
#        limits:
#          memory: 1G

#  node_6:
#    image: "p2p-fl:latest"
#
#    volumes:
#      - ./demo:/home/demo
#      - ./data/node-6:/home/work/p2plib/cmd/flat/data
#    environment:
#      - NODE_ID=6
#      - GROUP_ID=2
#      - SELF_IP=172.20.0.7
#    networks:
#      commnet:
#        ipv4_address: 172.20.0.7
#    restart: on-failure
#    depends_on:
#      - node_5
#    deploy:
#      resources:
#        limits:
#          memory: 1G
